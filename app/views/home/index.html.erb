<!DOCTYPE html>
<html lang="en">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>
    <%= stylesheet_link_tag "tailwind", "inter-font", media: 'all', "data-turbo-track": "reload" %>
    <%= stylesheet_link_tag 'application', media: 'all', 'data-turbolinks-track': 'reload' %>
    <%= javascript_importmap_tags "application" %>
  </head>
  <body>
    <div>
      <div class="flex items-center space-x-4">
        <%= image_tag 'logo.jpg', alt: "Logo", class: 'my-6' %>
        <%= image_tag @avatar, alt: "Avatar", class: 'w-24 h-24 rounded-full' %>
      </div>
      <p>
        <%= "Hello, #{@user.name}, welcome to Line - The Developers Marketplace " %>
      </p>
      <p>
        <% if @organizations.present? %>
          <ul>
            <% @organizations.each do |org| %>
              <li>
                <a href="https://github.com/<%= org.login %>" class="flex items-center space-x-4 hover:bg-gray-100 p-2 rounded" target="_blank" rel="noopener noreferrer">
                  <%= image_tag org.avatar_url, alt: "#{org.login} logo", class: 'w-8 h-8' %>
                  <span><%= org.login %></span>
                </a>
              </li>
            <% end %>
          </ul>
        <% else %>
          <p>No organizations found.</p>
        <% end %>
      </p>
      <div>
        <% if @repos.present? %>
          <table>
            <tbody class="bg-white divide-y divide-gray-200">
              <% @repos.each do |repo| %>
                <tr>
                  <td class="px-6 py-4 whitespace-nowrap">
                    <div class="flex justify-between items-center w-full">
                      <div>
                        <!-- Display Organization Logo -->
                        <% if repo[:org_avatar_url] %>
                          <%= image_tag repo[:org_avatar_url], alt: "Organization logo", class: "w-8 h-8 mr-4 inline" %>
                        <% else %>
                          <%= image_tag @avatar, alt: "User logo", class: "w-8 h-8 mr-4 inline rounded-full" %>
                        <% end %>
                        <!-- Repository Name as Link -->
                        <span class="align-middle inline">
                          <%= link_to repo[:repo].full_name, "https://github.com/#{repo[:repo].full_name}", target: "_blank", rel: "noopener noreferrer", class: "text-blue-600 hover:text-blue-800" %>
                        </span>
                        <!-- Display User's Repository Permission -->
                        <td class="px-6 py-4 whitespace-nowrap">
                          <span><%= repo[:user_permission].capitalize %></span>
                        </td>
                      </div>
                      <!-- Option Buttons -->
                      <td class="px-6 py-4 whitespace-nowrap">
                        <button class="bg-blue-500 text-white px-4 py-2 rounded" onclick="copyToClipboard('<%= repo['html_url'] %>')">
                          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 7.5V6.108c0-1.135.845-2.098 1.976-2.192.373-.03.748-.057 1.123-.08M15.75 18H18a2.25 2.25 0 0 0 2.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 0 0-1.123-.08M15.75 18.75v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5A3.375 3.375 0 0 0 6.375 7.5H5.25m11.9-3.664A2.251 2.251 0 0 0 15 2.25h-1.5a2.251 2.251 0 0 0-2.15 1.586m5.8 0c.065.21.1.433.1.664v.75h-6V4.5c0-.231.035-.454.1-.664M6.75 7.5H4.875c-.621 0-1.125.504-1.125 1.125v12c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V16.5a9 9 0 0 0-9-9Z" />
                          </svg>
                        </button>
                      </td>
                      <% if repo[:user_permission] == 'admin' || repo[:user_permission] == 'maintainer' %>
                        <td>
                          <a href="#" class="inline-block">
                            <button class="bg-blue-500 text-white px-4 py-2 rounded flex items-center justify-center">
                              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v12m-3-2.818.879.659c1.171.879 3.07.879 4.242 0 1.172-.879 1.172-2.303 0-3.182C13.536 12.219 12.768 12 12 12c-.725 0-1.45-.22-2.003-.659-1.106-.879-1.106-2.303 0-3.182s2.9-.879 4.006 0l.415.33M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
                              </svg>
                            </button>
                          </a>
                        </td>
                      <% end %>
                    </div>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        <% else %>
          <p>No repos found.</p>
        <% end %>
      </div>
      <script>
        function copyToClipboard(text) {
          if (typeof document !== 'undefined') {
            const input = document.createElement('textarea');
            input.value = text;
            document.body.appendChild(input);
            input.select();

            try {
              document.execCommand('copy');
              alert('Link copied to clipboard!');
            } catch (err) {
              console.error('Unable to copy to clipboard:', err);
            } finally {
              document.body.removeChild(input);
            }
          } else {
            // Handle non-browser environment (e.g., Node.js)
            console.warn('Clipboard copying not supported in non-browser environments.');
          }
        }
      </script>
    </div>
  </body>
</html>
