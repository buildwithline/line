<!DOCTYPE html>
<html lang="en">

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <%= csrf_meta_tags %>
  <%= csp_meta_tag %>
  <%= stylesheet_link_tag "tailwind", "inter-font", media: 'all', "data-turbo-track": "reload" %>
  <%= stylesheet_link_tag 'application', media: 'all', 'data-turbolinks-track': 'reload' %>
  <%= javascript_importmap_tags "application" %>
</head>


<body>
  <div>
    <div class="flex items-center space-x-4">
      <%= image_tag 'logo.jpg', alt: "Logo", class: 'my-6' %>
      <%= image_tag @avatar, alt: "Avatar", class: 'w-24 h-24 rounded-full' %>
    </div>
    
    <p>
      <%= "Hello, #{@user.name}, welcome to Line - The Developers Marketplace " %>
    </p>

    <% if @organizations.present? %>
      <ul>
        <% @organizations.each do |org| %>
          <li>
            <a href="https://github.com/<%= org.login %>" class="flex items-center space-x-4 hover:bg-gray-100 p-2 rounded" target="_blank" rel="noopener noreferrer">
              <%= image_tag org.avatar_url, alt: "#{org.login} logo", class: 'w-8 h-8' %>
              <span><%= org.login %></span>
            </a>
          </li>
        <% end %>
      </ul>
    <% else %>
      <p>No organizations found.</p>
    <% end %>

    <% if @repos.present? %>
      <table class="min-w-full divide-y divide-gray-200">
        <tbody>
          <% @repos.each do |repo| %>
            <tr>
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="flex justify-between items-center w-full">
                  <div>
                    <% if repo[:org_avatar_url] %>
                      <%= image_tag repo[:org_avatar_url], alt: "Organization logo", class: "w-8 h-8 mr-4 inline" %>
                    <% else %>
                      <%= image_tag @avatar, alt: "User logo", class: "w-8 h-8 mr-4 inline rounded-full" %>
                    <% end %>
                    <span class="align-middle inline">
                      <%= link_to repo[:repo].full_name, "https://github.com/#{repo[:repo].full_name}", target: "_blank", rel: "noopener noreferrer", class: "text-blue-600 hover:text-blue-800" %>
                    </span>
                  </div>
                  <div class="px-6 py-4 whitespace-nowrap">
                    <% if repo[:admin] %>
                      <span>Admin</span>
                    <% else %>
                      <span>Not Admin</span>
                    <% end %>
                  </div>
                  <div class="px-6 py-4 whitespace-nowrap">
                    <button class="bg-blue-500 text-white px-4 py-2 rounded" onclick="copyToClipboard('<%= repo[:repo][:html_url] %>')">
                      <!-- SVG icon here -->
                    </button>
                  </div>
                </div>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    <% else %>
      <p>No repos found.</p>
    <% end %>
  </div>

  <script>
    function copyToClipboard(text) {
      if (typeof document !== 'undefined') {
        const input = document.createElement('textarea');
        input.value = text;
        document.body.appendChild(input);
        input.select();

        try {
          document.execCommand('copy');
          alert('Link copied to clipboard!');
        } catch (err) {
          console.error('Unable to copy to clipboard:', err);
        } finally {
          document.body.removeChild(input);
        }
      } else {
        // Handle non-browser environment (e.g., Node.js)
        console.warn('Clipboard copying not supported in non-browser environments.');
      }
    }
  </script>
</body>

</html>
